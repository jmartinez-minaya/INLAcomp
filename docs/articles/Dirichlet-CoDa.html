<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure • INLAcomp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">INLAcomp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Dirichlet-CoDa.html">Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure</h1>
            <h3 data-toc-skip class="subtitle">Version 1.0.0</h3>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2024-09-18
14:21:35.544711</h4>
      

      <div class="d-none name"><code>Dirichlet-CoDa.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">### --- 0. Loading libraries --- ####</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stat.boogaart.de/compositions/" class="external-link">compositions</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="an-introduction-to-the-logistic-normal-dirichlet-regression">An introduction to the Logistic Normal Dirichlet Regression<a class="anchor" aria-label="anchor" href="#an-introduction-to-the-logistic-normal-dirichlet-regression"></a>
</h2>
<p>As defined in <span class="citation">Martı́nez-Minaya and Rue
(2024)</span>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐲</mi><mo>∈</mo><msup><mi>𝕊</mi><mi>D</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol{y} \in \mathbb{S}^D</annotation></semantics></math>
follows a logistic-normal distribution with Dirichlet covariance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>ℒ</mi><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{LND}(\boldsymbol{\mu}, \boldsymbol{\Sigma})</annotation></semantics></math>
if and only if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">alr(\boldsymbol{y}) \sim \mathcal{N}(\boldsymbol{\mu},
\boldsymbol{\Sigma})</annotation></semantics></math>, and:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Σ</mi><mrow><mi>d</mi><mi>d</mi></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><msubsup><mi>σ</mi><mi>d</mi><mn>2</mn></msubsup><mo>+</mo><mi>γ</mi><mspace width="0.167em"></mspace><mo>,</mo><mspace width="0.222em"></mspace><mi>d</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>D</mi><mo>−</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>Σ</mi><mrow><mi>d</mi><mi>k</mi></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>γ</mi><mspace width="0.167em"></mspace><mo>,</mo><mi>d</mi><mo>≠</mo><mi>k</mi><mspace width="0.167em"></mspace></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation} \begin{array}{rcl}
\Sigma_{dd} &amp; = &amp; \sigma_d^2 + \gamma \,, \ d = 1, \ldots, D-1 \\
\Sigma_{dk} &amp; = &amp; \gamma\,, d \neq k \, \nonumber \end{array}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>d</mi><mn>2</mn></msubsup><mo>+</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\sigma_d^2 + \gamma</annotation></semantics></math>
represents the variance of each log-ratio and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
is the covariance between log-ratios. From now on we will refer to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{ND}(\boldsymbol{\mu},\boldsymbol{\Sigma})</annotation></semantics></math>
as the multivariate normal with Dirichlet covariance structure.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\boldsymbol{y}</annotation></semantics></math>
be a multivariate random variable such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐲</mi><mo>∼</mo><mrow><mi>ℒ</mi><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{y} \sim \mathcal{LND}(\boldsymbol{\mu},
\boldsymbol{\Sigma})</annotation></semantics></math>, which by
definition is equivalent to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mrow><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">alr(\boldsymbol{y} ) \sim \mathcal{ND}(\boldsymbol{\mu},
\boldsymbol{\Sigma})</annotation></semantics></math>. Because of its
easy interpretability in terms of log-ratios with the reference
category, we focus on modelling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐲</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">alr(\boldsymbol{y})</annotation></semantics></math>
as a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{ND}(\boldsymbol{\mu},
\boldsymbol{\Sigma})</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="simulated-example-i-type-ii">Simulated example I (Type II)<a class="anchor" aria-label="anchor" href="#simulated-example-i-type-ii"></a>
</h2>
<p>The model with which we are going to operate in this example presents
the following structure:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>a</mi><mi>l</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐘</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mo>∼</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><mi>…</mi><mo>,</mo><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>𝐗</mi><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mspace width="0.167em"></mspace><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{eqnarray}
    alr(\boldsymbol{Y} ) &amp; \sim &amp; \mathcal{ND}((\boldsymbol{\mu}^{(1)}, \ldots, \boldsymbol{\mu}^{(D)}), \boldsymbol{\Sigma}) \\
    \boldsymbol{\mu}^{(d)} &amp; = &amp; \boldsymbol{X} \boldsymbol{\beta}^{(d)} 
\label{eq::model_arabidopsis}\,, 
\end{eqnarray}</annotation></semantics></math></p>
<p>Note that this is the second structure presented in <span class="citation">Martı́nez-Minaya and Rue (2024)</span>, where we are
working under the assumption that covariates have different effect in
each linear predictor. In particular, we consider
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">D = 3</annotation></semantics></math>,
and the reference category is the third one. So, we are dealing with two
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates.
Also, we just generate a covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
scaled to have mean 0 and standard deviation 1.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>a</mi><mi>l</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐘</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="center" style="text-align: center"><mo>∼</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mi>𝒩</mi><mi>𝒟</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>𝚺</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><msubsup><mi>β</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msubsup><mi>β</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mi>𝐱</mi><mspace width="0.167em"></mspace><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><msubsup><mi>β</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msubsup><mi>β</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mi>𝐱</mi><mspace width="0.167em"></mspace><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{eqnarray}
    alr(\boldsymbol{Y} ) &amp; \sim &amp; \mathcal{ND}((\boldsymbol{\mu}^{(1)},  \boldsymbol{\mu}^{(2)}), \boldsymbol{\Sigma}) \,, \\
    \boldsymbol{\mu}^{(1)} &amp; = &amp; \beta_0^{(1)} + \beta_1^{(1)} \boldsymbol{x} \nonumber \,,\\
    \boldsymbol{\mu}^{(2)} &amp; = &amp; \beta_1^{(2)} + \beta_1^{(2)} \boldsymbol{x} \,.
\label{eq::model_sim}
\end{eqnarray}</annotation></semantics></math></p>
<div class="section level3">
<h3 id="data-simulation">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">201803</span><span class="op">)</span></span>
<span><span class="va">inla.seed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1E6</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">70</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="defining-hyperparameters-and-dimensionality-of-the-response">Defining hyperparameters and dimensionality of the response<a class="anchor" aria-label="anchor" href="#defining-hyperparameters-and-dimensionality-of-the-response"></a>
</h4>
<p>We start defining the hyperparameters of the likelihood:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mn>1</mn><mn>2</mn></msubsup><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\sigma_1^2 =
0.5</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mn>2</mn><mn>2</mn></msubsup><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">\sigma_2^2 = 0.4</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\gamma = 0.1</annotation></semantics></math>,
and computing the correlation matrix of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### --- 1. Simulation --- ####</span></span>
<span><span class="co"># Parameters for the simulation</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">cov_param</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">sigma_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2</span> <span class="op">+</span> <span class="va">cov_param</span><span class="op">)</span></span>
<span><span class="va">hypers_lik</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>hypers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma2</span>, <span class="va">cov_param</span><span class="op">)</span>,</span>
<span>                         name1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma2.1"</span>, <span class="st">"sigma2.2"</span>, <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># We create the correlation parameters based on the previous idea</span></span>
<span><span class="co"># We are going to have ((D-1)^2 - (D-1))/2 rhos</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">sigma_diag</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">cov_param</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">sigma_diag</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rho</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]  [,2]</span></span>
<span><span class="co">## [1,] 1.000 0.183</span></span>
<span><span class="co">## [2,] 0.183 1.000</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="simulating-a-covariate">Simulating a covariate<a class="anchor" aria-label="anchor" href="#simulating-a-covariate"></a>
</h4>
<p>We define the covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐱</mi><annotation encoding="application/x-tex">\boldsymbol{x}</annotation></semantics></math>
and also, the corresponding betas, constructing the corresponding linear
predictor.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span></span>
<span><span class="co"># - mean 0 to not affect intercept</span></span>
<span><span class="va">betas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="va">lin.pred</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="alr-coordinates">alr-coordinates<a class="anchor" aria-label="anchor" href="#alr-coordinates"></a>
</h4>
<p>We construct the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### ------- 1.2.3. Constructing the likelihood --- ####</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">sigma_diag</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">sigma_diag</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="va">Sigma</span><span class="op">*</span><span class="va">rho</span></span>
<span></span>
<span><span class="va">lin.pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span> n  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             mu <span class="op">=</span> <span class="va">z</span>,</span>
<span>             Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">alry</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data-in-the-simplex">Data in the simplex<a class="anchor" aria-label="anchor" href="#data-in-the-simplex"></a>
</h4>
<p>We move back to the Simplex using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-inverse,
in particular, we use the function <code>alrInv</code> form the
R-package <code>compositions</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">y.simplex</span> <span class="op">&lt;-</span> <span class="fu">compositions</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alrInv</a></span><span class="op">(</span><span class="va">alry</span><span class="op">)</span></span>
<span>  <span class="va">y.simplex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y.simplex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="va">D</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y.simplex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">D</span><span class="op">)</span>  </span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">alry</span>, <span class="va">y.simplex</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alry."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   alry.1 alry.2    y1     y2    y3       x</span></span>
<span><span class="co">## 1 -1.580  -1.46 0.143 0.1620 0.695  0.0265</span></span>
<span><span class="co">## 2 -1.345  -3.18 0.200 0.0318 0.768 -0.3708</span></span>
<span><span class="co">## 3 -1.735  -1.52 0.126 0.1567 0.717  0.0819</span></span>
<span><span class="co">## 4 -1.012  -2.01 0.243 0.0898 0.667 -0.0377</span></span>
<span><span class="co">## 5 -0.584  -1.53 0.314 0.1224 0.563  0.0775</span></span>
<span><span class="co">## 6 -0.041   2.10 0.095 0.8060 0.099  0.3962</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="plotting-the-simulated-data">Plotting the simulated data<a class="anchor" aria-label="anchor" href="#plotting-the-simulated-data"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Alr coordinates</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> ,<span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"alr"</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"y.names"</span>, values_to <span class="op">=</span> <span class="st">"y.resp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y.resp</span>, fill <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"alr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">y.names</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">p_alr</span></span>
<span></span>
<span><span class="co">#pdf("simulated_data.pdf", width = 8, height = 6)</span></span>
<span><span class="va">p_alr</span></span></code></pre></div>
<div class="figure">
<img src="figures%2Fconditional-logit%2Funnamed-chunk-7-1.png" alt="Simulated data using alr-coordinates in terms of x" width="700"><p class="caption">
Simulated data using alr-coordinates in terms of x
</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data-preparation-for-fitting">Data preparation for fitting<a class="anchor" aria-label="anchor" href="#data-preparation-for-fitting"></a>
</h3>
<div class="section level4">
<h4 id="index-for-individual">Index for individual<a class="anchor" aria-label="anchor" href="#index-for-individual"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">data</span><span class="op">$</span><span class="va">id.z</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extending-the-dataset">Extending the dataset<a class="anchor" aria-label="anchor" href="#extending-the-dataset"></a>
</h4>
<p>We extent the data with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates
for introducing in <code>inla.stack</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ext</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alry."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      names_to  <span class="op">=</span> <span class="st">"y.names"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"y.resp"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">y.names</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">data_ext</span><span class="op">$</span><span class="va">y.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">$</span><span class="va">y.names</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##       y1     y2     y3       x  id.z y.names  y.resp</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0.143  0.162  0.695   0.026<span style="text-decoration: underline;">5</span>     1 alry.1  -<span style="color: #BB0000;">1.58</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0.200  0.031<span style="text-decoration: underline;">8</span> 0.768  -<span style="color: #BB0000;">0.371</span>      2 alry.1  -<span style="color: #BB0000;">1.35</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0.126  0.157  0.717   0.081<span style="text-decoration: underline;">9</span>     3 alry.1  -<span style="color: #BB0000;">1.74</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0.243  0.089<span style="text-decoration: underline;">8</span> 0.667  -<span style="color: #BB0000;">0.037</span><span style="color: #BB0000; text-decoration: underline;">7</span>     4 alry.1  -<span style="color: #BB0000;">1.01</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0.314  0.122  0.563   0.077<span style="text-decoration: underline;">5</span>     5 alry.1  -<span style="color: #BB0000;">0.584</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0.095<span style="text-decoration: underline;">0</span> 0.806  0.099<span style="text-decoration: underline;">0</span>  0.396      6 alry.1  -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="response-in-r-inla">Response in <code>R-INLA</code><a class="anchor" aria-label="anchor" href="#response-in-r-inla"></a>
</h4>
<p>We create a matrix with dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(N \times (D-1)) \times (D-1)</annotation></semantics></math>
for including the multivariate response in <code>R-INLA</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">names_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alry."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names_y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">y.names</span> <span class="op">==</span> <span class="va">names_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_comp_i</span></span>
<span>    <span class="co">#Response</span></span>
<span>    <span class="va">y_alr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="va">names_y</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_comp_i</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_alr</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data_comp_i</span><span class="op">$</span><span class="va">y.resp</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y.resp</span></span>
<span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names_y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y_aux</span> <span class="op">&lt;-</span> <span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">y.resp</span>, <span class="va">y.names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">y.names</span> <span class="op">==</span> <span class="va">names_y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">y.resp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>    <span class="va">aux_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">aux_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="fu">kronecker</span><span class="op">(</span><span class="va">aux_vec</span>, <span class="va">y_aux</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y_list</span></span>
<span></span>
<span><span class="va">y_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">y_list</span><span class="op">)</span></span>
<span><span class="va">y_tot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1] [,2]</span></span>
<span><span class="co">## [1,] -1.580   NA</span></span>
<span><span class="co">## [2,] -1.345   NA</span></span>
<span><span class="co">## [3,] -1.735   NA</span></span>
<span><span class="co">## [4,] -1.012   NA</span></span>
<span><span class="co">## [5,] -0.584   NA</span></span>
<span><span class="co">## [6,] -0.041   NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="covariates-in-r-inla">Covariates in <code>R-INLA</code><a class="anchor" aria-label="anchor" href="#covariates-in-r-inla"></a>
</h4>
<p>Covariates are going to be included in the model as random effects
with big variance. So, we need the values of the covariates, and also,
an index indicating to which alr-coordinate it belongs.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intercept"</span>, <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"id."</span>, <span class="va">variables</span><span class="op">)</span></span>
<span><span class="va">id.variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">$</span><span class="va">y.names</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">id.variables</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id.names</span></span>
<span></span>
<span><span class="va">variables</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "intercept" "x"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id.variables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      id.intercept id.x</span></span>
<span><span class="co">## [1,]            1    1</span></span>
<span><span class="co">## [2,]            1    1</span></span>
<span><span class="co">## [3,]            1    1</span></span>
<span><span class="co">## [4,]            1    1</span></span>
<span><span class="co">## [5,]            1    1</span></span>
<span><span class="co">## [6,]            1    1</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="inla-stack">
<code>inla.stack</code><a class="anchor" aria-label="anchor" href="#inla-stack"></a>
</h4>
<p>We create an <code>inla.stack</code> for estimation</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stk.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">y_tot</span><span class="op">)</span>,</span>
<span>                      A       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                      effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                             <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                           <span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                             <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"id.z"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                           <span class="va">id.variables</span>,</span>
<span>                                           intercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      tag     <span class="op">=</span> <span class="st">'est'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>In this section, we fit a model (Type II in the manuscript), and we
obtain the marginal posterior distribution of the parameters and
hyperparameters</p>
<div class="section level4">
<h4 id="fit-in-r-inla">Fit in <code>R-INLA</code><a class="anchor" aria-label="anchor" href="#fit-in-r-inla"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Have different parameters for fixed effects, and do not include spatial random effects.</span></span>
<span><span class="va">list_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Fitting the model</span></span>
<span><span class="va">formula.typeII</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.intercept</span>, <span class="va">intercept</span>,</span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.x</span>, <span class="va">x</span>,</span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">model.typeII</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeII</span>,</span>
<span>                     family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                     control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                                              compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                     control.family <span class="op">=</span> <span class="va">list_prior</span>,</span>
<span>                     inla.mode <span class="op">=</span> <span class="st">"experimental"</span> ,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="marginal-posterior-distribution-of-the-fixed-effects">Marginal posterior distribution of the fixed effects<a class="anchor" aria-label="anchor" href="#marginal-posterior-distribution-of-the-fixed-effects"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Posterior distribution of the fixed effects</span></span>
<span><span class="va">data_fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id.x</span><span class="op">$</span><span class="va">index.1</span><span class="op">)</span>,</span>
<span>                               alr <span class="op">=</span> <span class="st">"alr(y1/y3)"</span>,</span>
<span>                               var <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>                               param <span class="op">=</span> <span class="st">"beta1"</span>,</span>
<span>                               real  <span class="op">=</span> <span class="va">betas</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id.x</span><span class="op">$</span><span class="va">index.2</span><span class="op">)</span>,</span>
<span>                               alr <span class="op">=</span> <span class="st">"alr(y2/y3)"</span>,</span>
<span>                               var <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>                               param <span class="op">=</span> <span class="st">"beta1"</span>,</span>
<span>                               real  <span class="op">=</span> <span class="va">betas</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id.intercept</span><span class="op">$</span><span class="va">index.1</span><span class="op">)</span>,</span>
<span>                               alr <span class="op">=</span> <span class="st">"alr(y1/y3)"</span>,</span>
<span>                               var <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>                               param <span class="op">=</span> <span class="st">"beta0"</span>,</span>
<span>                               real <span class="op">=</span> <span class="va">betas</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id.intercept</span><span class="op">$</span><span class="va">index.2</span><span class="op">)</span>,</span>
<span>                               alr <span class="op">=</span> <span class="st">"alr(y2/y3)"</span>,</span>
<span>                               var <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>                               param <span class="op">=</span> <span class="st">"beta0"</span>,</span>
<span>                               real <span class="op">=</span> <span class="va">betas</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_fixed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#ggtitle("Effect of the covariate bio12") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_fixed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">real</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="co"># scale_color_manual(values=c("#E75F00", "#56B4E9"))+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">param</span> <span class="op">+</span> <span class="va">alr</span>, ncol <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">^</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">p</span><span class="op">(</span><span class="va">beta</span><span class="op">^</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">*</span><span class="st">'|'</span><span class="op">*</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pdf("posterior_fixed.pdf", width = 6, height = 5)</span></span>
<span><span class="va">p_fixed</span></span></code></pre></div>
<p><img src="figures%2Fconditional-logit%2Funnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="marginal-posterior-distribution-of-the-hyperparameters">Marginal Posterior distribution of the hyperparameters<a class="anchor" aria-label="anchor" href="#marginal-posterior-distribution-of-the-hyperparameters"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Posterior distribution of the hyperparameters</span></span>
<span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sigma2.1 <span class="op">=</span> <span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">$</span><span class="va">`Precision for the Gaussian observations`</span>,</span>
<span>             sigma2.2 <span class="op">=</span> <span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">$</span><span class="va">`Precision for the Gaussian observations[2]`</span>,</span>
<span>             gamma <span class="op">=</span> <span class="va">model.typeII</span><span class="op">$</span><span class="va">marginals.hyper</span><span class="op">$</span><span class="va">`Precision for id.z`</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span>,</span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span><span class="va">prec</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>                <span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span>,</span>
<span>                   <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, name1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>                   <span class="op">}</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span>,</span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma2.1"</span>, <span class="st">"sigma2.2"</span>,</span>
<span>                                     <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p.hyper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hyper.df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hypers_lik</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">hypers</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">name1</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">p</span><span class="op">(</span><span class="va">theta</span><span class="op">*</span><span class="st">'|'</span><span class="op">*</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pdf("marginals_hyperpar.pdf", width = 6, height = 3)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p.hyper</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fconditional-logit%2Funnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="predicting-for-a-new-observation">Predicting for a new observation<a class="anchor" aria-label="anchor" href="#predicting-for-a-new-observation"></a>
</h3>
<p>This section, is devoted to explain how to make predictions. We want
to predict, for the values of the covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo>−</mo><mn>0.5</mn><mo>,</mo><mo>−</mo><mn>0.2</mn><mo>,</mo><mn>0.1</mn><mo>,</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">x = -0.5, -0.2, 0.1,
0.4</annotation></semantics></math>. In particular, we show how to
compute the posterior preditive distribution for the mean of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates.
Posteriorly, we move back to the Simplex.</p>
<div class="section level4">
<h4 id="preparing-dataset-for-predictions">Preparing dataset for predictions<a class="anchor" aria-label="anchor" href="#preparing-dataset-for-predictions"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">x.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">n.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x.pred</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n ----------------------------------------------- \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  -----------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Creating the data.frame for predictions \n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating the data.frame for predictions</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x.pred</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id.z.pred</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">(</span><span class="va">N</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">N</span> <span class="op">+</span> <span class="va">n.pred</span><span class="op">)</span>, <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#random effect z to model the correlation</span></span>
<span></span>
<span><span class="co"># Category</span></span>
<span><span class="va">id.cat_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n.pred</span>, <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Index for covariates</span></span>
<span><span class="va">variables_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intercept"</span>, <span class="va">data_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id.names_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"id."</span>, <span class="va">variables_pred</span><span class="op">)</span></span>
<span><span class="va">id.variables_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">id.cat_pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables_pred</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables_pred</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">id.variables_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id.names_pred</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="preparing-inla-stack-for-predictions">Preparing <code>inla.stack</code> for predictions<a class="anchor" aria-label="anchor" href="#preparing-inla-stack-for-predictions"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stk.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>                                                    nrow <span class="op">=</span> <span class="va">n.pred</span><span class="op">*</span><span class="op">(</span><span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       A       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                       effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_pred</span>,</span>
<span>                                            id.z <span class="op">=</span> <span class="va">id.z.pred</span>,</span>
<span>                                            <span class="va">id.variables_pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       tag     <span class="op">=</span> <span class="st">'pred'</span><span class="op">)</span></span>
<span><span class="co">### --- Total stack</span></span>
<span><span class="va">stk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span><span class="va">stk.est</span>, <span class="va">stk.pred</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeII</span>, </span>
<span>                 family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 data              <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>, </span>
<span>                 control.compute   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                 control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk</span><span class="op">)</span>, compute <span class="op">=</span> <span class="cn">TRUE</span>, link <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 control.mode      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">model.typeII</span><span class="op">$</span><span class="va">mode</span><span class="op">$</span><span class="va">theta</span>, restart <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                 control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                 num.threads       <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 inla.mode <span class="op">=</span> <span class="st">"experimental"</span> , </span>
<span>                 verbose           <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extracting-predictions-using-inla-posterior-sample">Extracting predictions using <code>inla.posterior.sample</code><a class="anchor" aria-label="anchor" href="#extracting-predictions-using-inla-posterior-sample"></a>
</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.values.mean</span> <span class="op">&lt;-</span> <span class="va">mod.pred</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.index</a></span><span class="op">(</span><span class="va">stk</span>, <span class="st">'pred'</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_sim_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/posterior.sample.html" class="external-link">inla.posterior.sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim</span>, result <span class="op">=</span> <span class="va">mod.pred</span><span class="op">)</span></span>
<span><span class="va">post_sim_predictor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/posterior.sample.html" class="external-link">inla.posterior.sample.eval</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">APredictor</span><span class="op">}</span>, <span class="va">post_sim_pred</span>, return.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">post_sim_idz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/posterior.sample.html" class="external-link">inla.posterior.sample.eval</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">id.z</span><span class="op">}</span>, <span class="va">post_sim_pred</span>, return.matrix <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ind.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.index</a></span><span class="op">(</span><span class="va">stk</span>, <span class="st">'pred'</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">ind.idz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.index</a></span><span class="op">(</span><span class="va">stk</span>, <span class="st">'est'</span><span class="op">)</span><span class="op">$</span><span class="va">data</span> <span class="co">#This is the shared random effect</span></span>
<span><span class="va">ind.idz</span> <span class="op">&lt;-</span> <span class="va">ind.idz</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ind.idz</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">post_sim_predictor</span><span class="op">[</span><span class="va">ind.pred</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">post_sim_predictor</span><span class="op">[</span><span class="va">ind.pred</span>, <span class="op">]</span><span class="op">-</span> </span>
<span>  <span class="fu">kronecker</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">post_sim_idz</span><span class="op">[</span><span class="op">-</span><span class="va">ind.idz</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_sim_pred_alr</span> <span class="op">&lt;-</span> <span class="va">post_sim_predictor</span><span class="op">[</span><span class="va">ind.pred</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Computing mean and sd</span></span>
<span><span class="va">pred_alr_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_sim_pred_alr</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_alr_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pred_alr_summary</span>, </span>
<span>                               y.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">names_y</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">n.pred</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                               x.pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x.pred</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pred_alr_summary</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_alr_summary</span></span></code></pre></div>
<pre><code><span><span class="co">##             mean     sd y.names x.pred</span></span>
<span><span class="co">## fun[2001] -2.543 0.0484  alry.1   -0.5</span></span>
<span><span class="co">## fun[2002] -1.620 0.0274  alry.1   -0.2</span></span>
<span><span class="co">## fun[2003] -0.696 0.0249  alry.1    0.1</span></span>
<span><span class="co">## fun[2004]  0.228 0.0443  alry.1    0.4</span></span>
<span><span class="co">## fun[2005] -3.467 0.0440  alry.2   -0.5</span></span>
<span><span class="co">## fun[2006] -1.995 0.0254  alry.2   -0.2</span></span>
<span><span class="co">## fun[2007] -0.522 0.0223  alry.2    0.1</span></span>
<span><span class="co">## fun[2008]  0.951 0.0386  alry.2    0.4</span></span></code></pre>
<!-- ### Comparing values -->
<!-- ```{r, fig.asp = 0.5} -->
<!-- ggplot(data = pred_alr_summary) + -->
<!--     geom_point(data = data_ext, aes(x = x, y = y.resp), col = "gray80") + -->
<!--   geom_line(aes(x = x.pred, y = X50.), col = "red4") + -->
<!--   geom_ribbon(aes(x = x.pred, ymin = X2.5., ymax = X97.5.), alpha = 0.4) + -->
<!--   facet_wrap(~y.names) + -->
<!--   theme_bw() -->
<!-- ``` -->
</div>
<div class="section level4">
<h4 id="predictions-in-the-simplex">Predictions in the simplex<a class="anchor" aria-label="anchor" href="#predictions-in-the-simplex"></a>
</h4>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###  Prediction in the simplex --- #####</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_sim_predictor</span><span class="op">[</span><span class="va">ind.pred</span>,<span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">alr_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">x</span>, ncol <span class="op">=</span> <span class="va">D</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">pred_simplex</span> <span class="op">&lt;-</span> <span class="fu">compositions</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alrInv</a></span><span class="op">(</span><span class="va">alr_pred</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pred_simplex</span><span class="op">)</span><span class="op">)</span> <span class="co">#Byrows</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">post_sim_pred_simplex</span></span>
<span></span>
<span><span class="co">#Computing credible intervals</span></span>
<span><span class="va">pred_simplex_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post_sim_pred_simplex</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_simplex_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pred_simplex_summary</span>, </span>
<span>                                   y.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y1"</span>, <span class="st">"y2"</span>, <span class="st">"y3"</span><span class="op">)</span>, <span class="va">n.pred</span><span class="op">)</span>,</span>
<span>                                   x.pred  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">x.pred</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">D</span>, <span class="va">n.pred</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pred_simplex_summary</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_simplex_summary</span></span></code></pre></div>
<pre><code><span><span class="co">##      mean      sd y.names x.pred</span></span>
<span><span class="co">## 1  0.0709 0.00318      y1   -0.5</span></span>
<span><span class="co">## 2  0.0281 0.00120      y2   -0.5</span></span>
<span><span class="co">## 3  0.9010 0.00336      y3   -0.5</span></span>
<span><span class="co">## 4  0.1484 0.00348      y1   -0.2</span></span>
<span><span class="co">## 5  0.1020 0.00236      y2   -0.2</span></span>
<span><span class="co">## 6  0.7495 0.00361      y3   -0.2</span></span>
<span><span class="co">## 7  0.2384 0.00475      y1    0.1</span></span>
<span><span class="co">## 8  0.2837 0.00481      y2    0.1</span></span>
<span><span class="co">## 9  0.4780 0.00418      y3    0.1</span></span>
<span><span class="co">## 10 0.2593 0.00955      y1    0.4</span></span>
<span><span class="co">## 11 0.5342 0.01083      y2    0.4</span></span>
<span><span class="co">## 12 0.2064 0.00509      y3    0.4</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-martinezminaya2023" class="csl-entry">
Martı́nez-Minaya, Joaquı́n, and Haavard Rue. 2024. <span>“A Flexible
Bayesian Tool for CoDa Mixed Models: Logistic-Normal Distribution with
Dirichlet Covariance.”</span> <em>Statistics and Computing</em> 34 (3):
116.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joaquín Martínez-Minaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
