[{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"an-introduction-to-the-logistic-normal-dirichlet-regression","dir":"Articles","previous_headings":"","what":"An introduction to the Logistic Normal Dirichlet Regression","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"defined Martƒ±ÃÅnez-Minaya Rue (2024), ùê≤‚ààùïäD\\boldsymbol{y} \\\\mathbb{S}^D follows logistic-normal distribution Dirichlet covariance ‚Ñíùí©ùíü(ùõç,ùö∫)\\mathcal{LND}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}) alr(ùê≤)‚àºùí©(ùõç,ùö∫)alr(\\boldsymbol{y}) \\sim \\mathcal{N}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}), : Œ£dd=œÉd2+Œ≥,d=1,‚Ä¶,D‚àí1Œ£dk=Œ≥,d‚â†k\\begin{equation} \\begin{array}{rcl} \\Sigma_{dd} & = & \\sigma_d^2 + \\gamma \\,, \\ d = 1, \\ldots, D-1 \\\\ \\Sigma_{dk} & = & \\gamma\\,, d \\neq k \\, \\nonumber \\end{array} \\end{equation} œÉd2+Œ≥\\sigma_d^2 + \\gamma represents variance log-ratio Œ≥\\gamma covariance log-ratios. now refer ùí©ùíü(ùõç,ùö∫)\\mathcal{ND}(\\boldsymbol{\\mu},\\boldsymbol{\\Sigma}) multivariate normal Dirichlet covariance structure. Let ùê≤\\boldsymbol{y} multivariate random variable ùê≤‚àº‚Ñíùí©ùíü(ùõç,ùö∫)\\boldsymbol{y} \\sim \\mathcal{LND}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}), definition equivalent alr(ùê≤)‚àºùí©ùíü(ùõç,ùö∫)alr(\\boldsymbol{y} ) \\sim \\mathcal{ND}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}). easy interpretability terms log-ratios reference category, focus modelling alr(ùê≤)alr(\\boldsymbol{y}) ùí©ùíü(ùõç,ùö∫)\\mathcal{ND}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma}).","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"simulated-example-i-type-ii","dir":"Articles","previous_headings":"","what":"Simulated example I (Type II)","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"model going operate example presents following structure: alr(ùêò)‚àºùí©ùíü((ùõç(1),‚Ä¶,ùõç(D)),ùö∫)ùõç(d)=ùêóùõÉ(d),\\begin{eqnarray}     alr(\\boldsymbol{Y} ) & \\sim & \\mathcal{ND}((\\boldsymbol{\\mu}^{(1)}, \\ldots, \\boldsymbol{\\mu}^{(D)}), \\boldsymbol{\\Sigma}) \\\\     \\boldsymbol{\\mu}^{(d)} & = & \\boldsymbol{X} \\boldsymbol{\\beta}^{(d)}  \\label{eq::model_arabidopsis}\\,,  \\end{eqnarray} Note second structure presented Martƒ±ÃÅnez-Minaya Rue (2024), working assumption covariates different effect linear predictor. particular, consider D=3D = 3, reference category third one. , dealing two alralr-coordinates. Also, just generate covariate xx scaled mean 0 standard deviation 1. alr(ùêò)‚àºùí©ùíü((ùõç(1),ùõç(2)),ùö∫),ùõç(1)=Œ≤0(1)+Œ≤1(1)ùê±,ùõç(2)=Œ≤1(2)+Œ≤1(2)ùê±.\\begin{eqnarray}     alr(\\boldsymbol{Y} ) & \\sim & \\mathcal{ND}((\\boldsymbol{\\mu}^{(1)},  \\boldsymbol{\\mu}^{(2)}), \\boldsymbol{\\Sigma}) \\,, \\\\     \\boldsymbol{\\mu}^{(1)} & = & \\beta_0^{(1)} + \\beta_1^{(1)} \\boldsymbol{x} \\nonumber \\,,\\\\     \\boldsymbol{\\mu}^{(2)} & = & \\beta_1^{(2)} + \\beta_1^{(2)} \\boldsymbol{x} \\,. \\label{eq::model_sim} \\end{eqnarray}","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"data-simulation","dir":"Articles","previous_headings":"Simulated example I (Type II)","what":"Data simulation","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"set.seed(201803) inla.seed = sample.int(n=1E6, size=1) options(width=70, digits=3)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"defining-hyperparameters-and-dimensionality-of-the-response","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data simulation","what":"Defining hyperparameters and dimensionality of the response","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"start defining hyperparameters likelihood: œÉ12=0.5\\sigma_1^2 = 0.5, œÉ22=0.4\\sigma_2^2 = 0.4 Œ≥=0.1\\gamma = 0.1, computing correlation matrix alralr-coordinates.","code":"### --- 1. Simulation --- #### # Parameters for the simulation D <- 3 N <- 1000 sigma2 <- c(0.5, 0.4) cov_param <- 0.1 sigma_diag <- sqrt(sigma2 + cov_param) hypers_lik <- data.frame(hypers = c(sigma2, cov_param),                          name1 = c(\"sigma2.1\", \"sigma2.2\", \"gamma\")) # We create the correlation parameters based on the previous idea # We are going to have ((D-1)^2 - (D-1))/2 rhos rho <- diag(1/sigma_diag) %*% matrix(cov_param, D-1, D-1) %*% diag(1/sigma_diag) diag(rho) <- 1 rho ##       [,1]  [,2] ## [1,] 1.000 0.183 ## [2,] 0.183 1.000"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"simulating-a-covariate","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data simulation","what":"Simulating a covariate","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"define covariate ùê±\\boldsymbol{x} also, corresponding betas, constructing corresponding linear predictor.","code":"x = runif(N)-0.5 # - mean 0 to not affect intercept betas = matrix(c(-1, 3, -1, 5), nrow = D-1, byrow = TRUE) X <- data.frame(1, x) %>% as.matrix(.) lin.pred <- X %*% t(betas)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"alr-coordinates","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data simulation","what":"alr-coordinates","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"construct alralr-coordinates","code":"### ------- 1.2.3. Constructing the likelihood --- #### Sigma <- matrix(sigma_diag, ncol = 1) %*% matrix(sigma_diag, nrow = 1) Sigma <- Sigma*rho  lin.pred %>%   apply(., 1, function(z)     MASS::mvrnorm( n  = 1,              mu = z,              Sigma = Sigma)) %>%   t(.)-> alry"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"data-in-the-simplex","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data simulation","what":"Data in the simplex","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"move back Simplex using alralr-inverse, particular, use function alrInv form R-package compositions.","code":"y.simplex <- compositions::alrInv(alry)   y.simplex <- as.numeric(t(y.simplex)) %>% matrix(., ncol = D, byrow = TRUE)   colnames(y.simplex) <- paste0(\"y\", 1:D)     data <- data.frame(alry, y.simplex, x) colnames(data)[1:(D-1)] <- c(paste0(\"alry.\", 1:(D-1))) data %>% head(.) ##   alry.1 alry.2    y1     y2    y3       x ## 1 -1.580  -1.46 0.143 0.1620 0.695  0.0265 ## 2 -1.345  -3.18 0.200 0.0318 0.768 -0.3708 ## 3 -1.735  -1.52 0.126 0.1567 0.717  0.0819 ## 4 -1.012  -2.01 0.243 0.0898 0.667 -0.0377 ## 5 -0.584  -1.53 0.314 0.1224 0.563  0.0775 ## 6 -0.041   2.10 0.095 0.8060 0.099  0.3962"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"plotting-the-simulated-data","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data simulation","what":"Plotting the simulated data","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"Simulated data using alr-coordinates terms x","code":"### Alr coordinates data %>%    tidyr::pivot_longer(., cols = ,starts_with(\"alr\"),                        names_to = \"y.names\", values_to = \"y.resp\") %>%   ggplot(data = .) +   geom_point(aes(x = x, y = y.resp, fill = x), shape = 21, size = 2) +   ylab(\"alr\") +   facet_wrap(~y.names) +   theme_bw() +   theme(legend.position = \"bottom\") -> p_alr  #pdf(\"simulated_data.pdf\", width = 8, height = 6) p_alr #dev.off()"},{"path":[]},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"index-for-individual","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data preparation for fitting","what":"Index for individual","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"data$id.z <- 1:dim(data)[1]"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"extending-the-dataset","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data preparation for fitting","what":"Extending the dataset","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"extent data alralr-coordinates introducing inla.stack","code":"data_ext <- data %>%   tidyr::pivot_longer(., cols = all_of(paste0(\"alry.\", 1:(D-1))),                       names_to  = \"y.names\",                       values_to = \"y.resp\") %>%   .[order(ordered(.$y.names)),] data_ext$y.names <- ordered(data_ext$y.names) head(data_ext) ## # A tibble: 6 √ó 7 ##       y1     y2     y3       x  id.z y.names  y.resp ##    <dbl>  <dbl>  <dbl>   <dbl> <int> <ord>     <dbl> ## 1 0.143  0.162  0.695   0.0265     1 alry.1  -1.58   ## 2 0.200  0.0318 0.768  -0.371      2 alry.1  -1.35   ## 3 0.126  0.157  0.717   0.0819     3 alry.1  -1.74   ## 4 0.243  0.0898 0.667  -0.0377     4 alry.1  -1.01   ## 5 0.314  0.122  0.563   0.0775     5 alry.1  -0.584  ## 6 0.0950 0.806  0.0990  0.396      6 alry.1  -0.0410"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"response-in-r-inla","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data preparation for fitting","what":"Response in R-INLA","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"create matrix dimension (N√ó(D‚àí1))√ó(D‚àí1)(N \\times (D-1)) \\times (D-1) including multivariate response R-INLA","code":"names_y <- paste0(\"alry.\", 1:(D-1)) 1:length(names_y) %>%   lapply(., function(i){     data_ext %>%       dplyr::filter(y.names == names_y[i]) -> data_comp_i     #Response     y_alr <- matrix(ncol = names_y %>% length(.), nrow = dim(data_comp_i)[1])     y_alr[, i] <- data_comp_i$y.resp   }) -> y.resp  1:length(names_y) %>%   lapply(., function(i){     y_aux <- data_ext %>%       dplyr::select(y.resp, y.names) %>%       dplyr::filter(y.names == names_y[i]) %>%       dplyr::select(y.resp) %>%       as.matrix(.)     aux_vec <- rep(NA, (D-1))     aux_vec[i] <- 1     kronecker(aux_vec, y_aux)   }) -> y_list  y_tot <- do.call(cbind, y_list) y_tot %>% head(.) ##        [,1] [,2] ## [1,] -1.580   NA ## [2,] -1.345   NA ## [3,] -1.735   NA ## [4,] -1.012   NA ## [5,] -0.584   NA ## [6,] -0.041   NA"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"covariates-in-r-inla","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data preparation for fitting","what":"Covariates in R-INLA","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"Covariates going included model random effects big variance. , need values covariates, also, index indicating alr-coordinate belongs.","code":"variables <- c(\"intercept\", data %>%                  dplyr::select(starts_with(\"x\")) %>%                  colnames(.)) id.names <- paste0(\"id.\", variables) id.variables <- rep(data_ext$y.names %>% as.factor(.) %>% as.numeric(.),                      length(variables)) %>%   matrix(., ncol = length(variables), byrow = FALSE) colnames(id.variables) <- id.names  variables ## [1] \"intercept\" \"x\" id.variables %>% head(.) ##      id.intercept id.x ## [1,]            1    1 ## [2,]            1    1 ## [3,]            1    1 ## [4,]            1    1 ## [5,]            1    1 ## [6,]            1    1"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"inla-stack","dir":"Articles","previous_headings":"Simulated example I (Type II) > Data preparation for fitting","what":"inla.stack","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"create inla.stack estimation","code":"stk.est <- inla.stack(data    = list(resp = y_tot),                       A       = list(1),                       effects = list(cbind(data_ext %>%                                              dplyr::select(starts_with(\"x\")),                                            data_ext %>%                                              dplyr::select(starts_with(\"id.z\")),                                            id.variables,                                            intercept = 1)),                       tag     = 'est')"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"fitting-the-model","dir":"Articles","previous_headings":"Simulated example I (Type II)","what":"Fitting the model","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"section, fit model (Type II manuscript), obtain marginal posterior distribution parameters hyperparameters","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"fit-in-r-inla","dir":"Articles","previous_headings":"Simulated example I (Type II) > Fitting the model","what":"Fit in R-INLA","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"# Have different parameters for fixed effects, and do not include spatial random effects. list_prior <- rep(list(list(prior = \"pc.prec\", param = c(1, 0.01))), D-1)  ### Fitting the model formula.typeII <- resp ~ -1 +   f(id.intercept, intercept,     model   = \"iid\",     initial = log(1/1000),     fixed   = TRUE) +   f(id.x, x,     model   = \"iid\",     initial = log(1/1000),     fixed   = TRUE) +   f(id.z,     model = \"iid\",     hyper = list(prec = list(prior = \"pc.prec\",                              param = c(1, 0.01))), constr = TRUE) model.typeII <- inla(formula.typeII,                      family         = rep(\"gaussian\", D-1),                      data           = inla.stack.data(stk.est),                      control.compute = list(config = TRUE),                      control.predictor = list(A = inla.stack.A(stk.est),                                               compute = TRUE),                      control.family = list_prior,                      inla.mode = \"experimental\" ,                      verbose = FALSE)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"marginal-posterior-distribution-of-the-fixed-effects","dir":"Articles","previous_headings":"Simulated example I (Type II) > Fitting the model","what":"Marginal posterior distribution of the fixed effects","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"### Posterior distribution of the fixed effects data_fixed <- rbind(data.frame(inla.smarginal(model.typeII$marginals.random$id.x$index.1),                                alr = \"alr(y1/y3)\",                                var = \"x\",                                param = \"beta1\",                                real  = betas[1,2]),                     data.frame(inla.smarginal(model.typeII$marginals.random$id.x$index.2),                                alr = \"alr(y2/y3)\",                                var = \"x\",                                param = \"beta1\",                                real  = betas[2,2]),                     data.frame(inla.smarginal(model.typeII$marginals.random$id.intercept$index.1),                                alr = \"alr(y1/y3)\",                                var = \"intercept\",                                param = \"beta0\",                                real = betas[1,1]),                     data.frame(inla.smarginal(model.typeII$marginals.random$id.intercept$index.2),                                alr = \"alr(y2/y3)\",                                var = \"intercept\",                                param = \"beta0\",                                real = betas[2,1]))  p_fixed <- ggplot() +   geom_line(data = data_fixed, aes(x = x, y = y), size = 0.9) +   #ggtitle(\"Effect of the covariate bio12\") +   theme_bw() +   geom_vline(data = data_fixed, aes(xintercept = real), col = \"red4\") +  # scale_color_manual(values=c(\"#E75F00\", \"#56B4E9\"))+   theme(legend.position = \"bottom\") +   facet_wrap(~param + alr, ncol = D-1, scales = \"free\") +   xlab(expression(beta^(d))) +   ylab(expression(p(beta^(d) *'|'* theta))) +   theme(legend.title = element_blank())  #pdf(\"posterior_fixed.pdf\", width = 6, height = 5) p_fixed #dev.off()"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"marginal-posterior-distribution-of-the-hyperparameters","dir":"Articles","previous_headings":"Simulated example I (Type II) > Fitting the model","what":"Marginal Posterior distribution of the hyperparameters","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"### Posterior distribution of the hyperparameters prec <- list(sigma2.1 = model.typeII$marginals.hyperpar$`Precision for the Gaussian observations`,              sigma2.2 = model.typeII$marginals.hyperpar$`Precision for the Gaussian observations[2]`,              gamma = model.typeII$marginals.hyper$`Precision for id.z`)  hyper <- lapply(1:length(prec),                 function(x){                   inla.smarginal(inla.tmarginal(prec[[x]], fun = function(y)(1/y))) %>%                     data.frame(.)                 }) names(hyper) <- names(prec)  hyper.df <- lapply(1:length(hyper),                    function(x){                      cbind(data.frame(hyper[[x]]), name1 = names(hyper)[x])                    })  %>%   do.call(rbind.data.frame, .)  hyper.df$name1 <- ordered(hyper.df$name1,                           levels = c(\"sigma2.1\", \"sigma2.2\",                                      \"gamma\")) p.hyper <- ggplot(hyper.df) +   geom_line(aes(x = x, y = y)) +   geom_vline(data = hypers_lik, aes(xintercept = hypers), col = \"red4\") +   facet_wrap(~ name1, scales = \"free\") +   theme_bw() +   xlab(expression(theta)) +   ylab(expression(p(theta*'|'*y)))  #pdf(\"marginals_hyperpar.pdf\", width = 6, height = 3) print(p.hyper) #dev.off()"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"predicting-for-a-new-observation","dir":"Articles","previous_headings":"Simulated example I (Type II)","what":"Predicting for a new observation","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"section, devoted explain make predictions. want predict, values covariate x=‚àí0.5,‚àí0.2,0.1,0.4x = -0.5, -0.2, 0.1, 0.4. particular, show compute posterior preditive distribution mean alralr-coordinates. Posteriorly, move back Simplex.","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"preparing-dataset-for-predictions","dir":"Articles","previous_headings":"Simulated example I (Type II) > Predicting for a new observation","what":"Preparing dataset for predictions","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"sim <- 1000 x.pred <- seq(-0.5, 0.5, 0.3) n.pred <- length(x.pred) cat(\"\\n ----------------------------------------------- \\n\") ##  ##  ----------------------------------------------- cat(\"Creating the data.frame for predictions \\n\") ## Creating the data.frame for predictions data_pred <- data.frame(intercept = 1,                         x = rep(x.pred, D-1)) id.z.pred  <- rep((N + 1):(N + n.pred), D - 1) #random effect z to model the correlation  # Category id.cat_pred <- rep(1:(D - 1), rep(n.pred, D - 1)) #Index for covariates variables_pred <- c(\"intercept\", data_pred %>%                        dplyr::select(starts_with(\"x\")) %>%                        colnames(.)) id.names_pred <- paste0(\"id.\", variables_pred) id.variables_pred <- rep(id.cat_pred, length(variables_pred)) %>%    matrix(., ncol = length(variables_pred), byrow = FALSE) colnames(id.variables_pred) <- id.names_pred"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"preparing-inla-stack-for-predictions","dir":"Articles","previous_headings":"Simulated example I (Type II) > Predicting for a new observation","what":"Preparing inla.stack for predictions","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"stk.pred <- inla.stack(data    = list(resp = matrix(NA, ncol = D - 1,                                                      nrow = n.pred*(D - 1))),                        A       = list(1),                        effects = list(cbind(data_pred,                                             id.z = id.z.pred,                                             id.variables_pred)),                        tag     = 'pred') ### --- Total stack stk <- inla.stack(stk.est, stk.pred)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"prediction","dir":"Articles","previous_headings":"Simulated example I (Type II) > Predicting for a new observation","what":"Prediction","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"mod.pred <- inla(formula.typeII,                   family         = rep(\"gaussian\", D - 1),                  data              = inla.stack.data(stk),                   control.compute   = list(config = TRUE),                  control.predictor = list(A = inla.stack.A(stk), compute = TRUE, link = 1),                  control.mode      = list(theta = model.typeII$mode$theta, restart = TRUE),                   control.family = list_prior,                     num.threads       = 2,                  inla.mode = \"experimental\" ,                   verbose           = FALSE)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"extracting-predictions-using-inla-posterior-sample","dir":"Articles","previous_headings":"Simulated example I (Type II) > Predicting for a new observation","what":"Extracting predictions using inla.posterior.sample","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"pred.values.mean <- mod.pred$summary.fitted.values$mean[inla.stack.index(stk, 'pred')$data] %>%    matrix(., ncol = D - 1, byrow = FALSE)  post_sim_pred <- inla.posterior.sample(n = sim, result = mod.pred) post_sim_predictor <- inla.posterior.sample.eval(fun = function(...){   APredictor}, post_sim_pred, return.matrix = TRUE) post_sim_idz <- inla.posterior.sample.eval(fun = function(...){   id.z}, post_sim_pred, return.matrix = TRUE)  ind.pred <- inla.stack.index(stk, 'pred')$data ind.idz <- inla.stack.index(stk, 'est')$data #This is the shared random effect ind.idz <- ind.idz[1:(length(ind.idz)/(D - 1))]  post_sim_predictor[ind.pred, ] <- post_sim_predictor[ind.pred, ]-    kronecker(rep(1, D-1), post_sim_idz[-ind.idz,])  post_sim_pred_alr <- post_sim_predictor[ind.pred,]  #Computing mean and sd pred_alr_summary <- t(apply(post_sim_pred_alr, 1, function(x){c(mean(x), sd(x))})) pred_alr_summary <- data.frame(pred_alr_summary,                                 y.names = rep(names_y, rep(n.pred, D-1)),                                x.pred = rep(x.pred, D-1)) colnames(pred_alr_summary)[1:2] <- c(\"mean\", \"sd\")  pred_alr_summary ##             mean     sd y.names x.pred ## fun[2001] -2.543 0.0484  alry.1   -0.5 ## fun[2002] -1.620 0.0274  alry.1   -0.2 ## fun[2003] -0.696 0.0249  alry.1    0.1 ## fun[2004]  0.228 0.0443  alry.1    0.4 ## fun[2005] -3.467 0.0440  alry.2   -0.5 ## fun[2006] -1.995 0.0254  alry.2   -0.2 ## fun[2007] -0.522 0.0223  alry.2    0.1 ## fun[2008]  0.951 0.0386  alry.2    0.4"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/articles/Dirichlet-CoDa.html","id":"predictions-in-the-simplex","dir":"Articles","previous_headings":"Simulated example I (Type II) > Predicting for a new observation","what":"Predictions in the simplex","title":"Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure","text":"","code":"###  Prediction in the simplex --- ##### apply(post_sim_predictor[ind.pred,], 2, function(x){   alr_pred <- matrix(x, ncol = D - 1)   pred_simplex <- compositions::alrInv(alr_pred)   as.numeric(t(pred_simplex)) #Byrows }) -> post_sim_pred_simplex  #Computing credible intervals pred_simplex_summary <- t(apply(post_sim_pred_simplex, 1, function(x){c(mean(x), sd(x))})) pred_simplex_summary <- data.frame(pred_simplex_summary,                                     y.names = rep(c(\"y1\", \"y2\", \"y3\"), n.pred),                                    x.pred  = rep(x.pred, rep(D, n.pred))) colnames(pred_simplex_summary)[1:2] <- c(\"mean\", \"sd\")  pred_simplex_summary ##      mean      sd y.names x.pred ## 1  0.0709 0.00318      y1   -0.5 ## 2  0.0281 0.00120      y2   -0.5 ## 3  0.9010 0.00336      y3   -0.5 ## 4  0.1484 0.00348      y1   -0.2 ## 5  0.1020 0.00236      y2   -0.2 ## 6  0.7495 0.00361      y3   -0.2 ## 7  0.2384 0.00475      y1    0.1 ## 8  0.2837 0.00481      y2    0.1 ## 9  0.4780 0.00418      y3    0.1 ## 10 0.2593 0.00955      y1    0.4 ## 11 0.5342 0.01083      y2    0.4 ## 12 0.2064 0.00509      y3    0.4"},{"path":[]},{"path":"https://jmartinez-minaya.github.io/INLAcomp/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Joaqu√≠n Mart√≠nez-Minaya. Maintainer.","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Mart√≠nez-Minaya J (2024). INLAcomp: Logistic-normal Dirichlet Model Compositional Data. R package version 0.1.0, https://jmartinez-minaya.github.io/INLAcomp/.","code":"@Manual{,   title = {INLAcomp: Logistic-normal Dirichlet Model for Compositional Data},   author = {Joaqu√≠n Mart√≠nez-Minaya},   year = {2024},   note = {R package version 0.1.0},   url = {https://jmartinez-minaya.github.io/INLAcomp/}, }"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/index.html","id":"inlacomp","dir":"","previous_headings":"","what":"INLAcomp","title":"Logistic-normal Dirichlet Model for Compositional Data","text":"goal INLAcomp analyze compositional data Logistic Normal distribution regression Dirichlet residuals (LNDM) using integrated nested Laplace approximation via R-INLA package. Method Martinez-Minaya Rue, 2024. tutorial fit simple LNDM model using R-INLA, click Spatial LNDM simulation conducted paper available . generated html availabe code Real example depicted paper available vignette. generated html available ","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Logistic-normal Dirichlet Model for Compositional Data","text":"yet CRAN, can install latest bugfix release INLAcomp github : r remotes::install_github(\"https://github.com/jmartinez-minaya/INLAcomp\")","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dic.mult.html","id":null,"dir":"Reference","previous_headings":"","what":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","title":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","text":"`dic.mult` computes DIC Multivariate Gaussian likelihood","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dic.mult.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","text":"","code":"dic.mult(inf, y)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dic.mult.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","text":"inf list nsim elements. element list result applying extract_lp_sigma. y matrix N x D response variable.","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dic.mult.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","text":"e.dev, dev.e, p.eff, dic","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dic.mult.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Computing dic for a Multivariate Gaussian likelihood ‚Äî dic.mult","text":"Joaqu√≠n Mart√≠nez-Minaya <jmarminaya@gmail.com>","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dmnorm.html","id":null,"dir":"Reference","previous_headings":"","what":"Computing multivariate Gaussian density ‚Äî dmnorm","title":"Computing multivariate Gaussian density ‚Äî dmnorm","text":"`dmnorm` computes multivariate joint density Gaussian distribution","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dmnorm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computing multivariate Gaussian density ‚Äî dmnorm","text":"","code":"dmnorm(y, mu, Sigma, log1 = FALSE)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dmnorm.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computing multivariate Gaussian density ‚Äî dmnorm","text":"y vector (1 x d) matrix (n x d) multivariate observations mu vector (1 x d) matrix (n x d) multivariate observations Sigma variance-covariance matrix (n x d) log1 TRUE logaritmith transformation used. Default FALSE.","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dmnorm.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Computing multivariate Gaussian density ‚Äî dmnorm","text":"Multivariate joint density Gaussian distribution","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/dmnorm.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Computing multivariate Gaussian density ‚Äî dmnorm","text":"Joaqu√≠n Mart√≠nez-Minaya <jmarminaya@gmail.com>","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/extract_lp_sigma.html","id":null,"dir":"Reference","previous_headings":"","what":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","title":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","text":"`extract_lp_sigma` Extracts posterior distribution linear predictor covariance matrix object obtained inla.posterior.sample","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/extract_lp_sigma.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","text":"","code":"extract_lp_sigma(xx)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/extract_lp_sigma.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","text":"xx resulting object applying function `inla.posterior.sample`","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/extract_lp_sigma.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","text":"list two objects: 1. Linear predictor substracting id.z. 2. Posterior Covariance matrix","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/extract_lp_sigma.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Extracting posterior distribution of the linear predictor a of the covariance matrix from an object obtained from inla.posterior.sample ‚Äî extract_lp_sigma","text":"Joaqu√≠n Mart√≠nez-Minaya <jmarminaya@gmail.com>","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/waic.mult.html","id":null,"dir":"Reference","previous_headings":"","what":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","title":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","text":"`waic.mult` computes WAIC Multivariate Gaussian likelihood","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/waic.mult.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","text":"","code":"waic.mult(inf, y)"},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/waic.mult.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","text":"inf list nsim elements. element list result applying extract_lp_sigma. y matrix N x D response variable.","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/waic.mult.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","text":"p.eff.waic, waic","code":""},{"path":"https://jmartinez-minaya.github.io/INLAcomp/reference/waic.mult.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Computing waic for a Multivariate Gaussian likelihood ‚Äî waic.mult","text":"Joaqu√≠n Mart√≠nez-Minaya <jmarminaya@gmail.com>","code":""}]
