<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure. An spatial simulation example • INLAcomp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure. An spatial simulation example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">INLAcomp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Dirichlet-CoDa.html">Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure</a></li>
    <li><a class="dropdown-item" href="../articles/simulations.html">Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure. An spatial simulation example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting CoDa using the Logistic Gaussian distribution with Dirichlet covariance structure. An spatial simulation example</h1>
                        <h4 data-toc-skip class="author">Joaquín
Martínez-Minaya — <a href="mailto:jmarmin@eio.upv.es" class="email">jmarmin@eio.upv.es</a>
</h4>
            
            <h4 data-toc-skip class="date">2024-09-20
15:16:09.008288</h4>
      

      <div class="d-none name"><code>simulations.Rmd</code></div>
    </div>

    
    
<p>This document has been created with the purpose of showing how one
can fit an LNDR model when dealing with compositional data based on
<span class="citation">Martı́nez-Minaya and Rue (2024)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jmartinez-minaya.github.io/INLAcomp/" class="external-link">INLAcomp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://xtable.r-forge.r-project.org/" class="external-link">xtable</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="functions-for-plotting">Functions for plotting<a class="anchor" aria-label="anchor" href="#functions-for-plotting"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## --------------------------------------</span></span>
<span><span class="co">#' Include a suffix to variable names</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Used with \code{\link[INLA]{inla.stack}} for building effect stacks.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x a data.frame</span></span>
<span><span class="co">#' @param suffix character string to be appended to variable names</span></span>
<span><span class="co">#' @param makeNA logical. If \code{TRUE}, returns the suffixed data.frame filled</span></span>
<span><span class="co">#'   with \code{NA}.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">suffix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">suffix</span>, <span class="va">makeNA</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="va">x</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="va">suffix</span>, sep <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">makeNA</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">### --- function to convert matrix to raster --- ####</span></span>
<span><span class="va">rotate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2</span>,<span class="va">rev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_to_raster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>, <span class="va">proj.grid.mat</span> <span class="op">=</span> <span class="va">proj.grid.mat</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rotate.html" class="external-link">rotate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         xmn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">proj.grid.mat</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         xmx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">proj.grid.mat</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         ymn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">proj.grid.mat</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         ymx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">proj.grid.mat</span><span class="op">$</span><span class="va">lattice</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Legend</span></span>
<span><span class="va">g_legend</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a.gplot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_gtable.html" class="external-link">ggplot_gtable</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html" class="external-link">ggplot_build</a></span><span class="op">(</span><span class="va">a.gplot</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">leg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">grobs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="st">"guide-box"</span><span class="op">)</span></span>
<span>  <span class="va">legend</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">leg</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">legend</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">###</span></span>
<span><span class="va">raster_spatial_effect</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spatial</span>, <span class="va">boundary</span>,</span>
<span>                                  <span class="va">boundary1</span> <span class="op">=</span> <span class="fu">INLAcomp</span><span class="fu">::</span><span class="va">polygon_IP</span>,</span>
<span>                                  <span class="va">rast</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">rast</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">raster_predict</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.projector</a></span><span class="op">(</span><span class="va">mesh</span>,</span>
<span>                              xlim <span class="op">=</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>                              ylim <span class="op">=</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,</span>
<span>                              dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"max"</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="st">"min"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"max"</span><span class="op">]</span><span class="op">-</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="st">"min"</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spatial</span><span class="op">)</span> <span class="op">==</span> <span class="va">mesh</span><span class="op">$</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">field.proj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span><span class="va">proj</span>, <span class="va">spatial</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">mesh</span><span class="op">$</span><span class="va">n</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">field1</span> <span class="op">&lt;-</span> <span class="fu">matrix_to_raster</span><span class="op">(</span><span class="va">field.proj</span>, proj.grid.mat <span class="op">=</span> <span class="va">proj</span><span class="op">)</span></span>
<span>    <span class="co">#field1 &lt;- crop(field1, boundary)</span></span>
<span>    <span class="co">#field1 &lt;- mask(field1, boundary)</span></span>
<span>    <span class="co">#plot(field1)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">spatial</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">2</span>,</span>
<span>                   <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                     <span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.project.html" class="external-link">inla.mesh.project</a></span><span class="op">(</span><span class="va">proj</span>, <span class="va">x</span><span class="op">)</span></span>
<span>                     <span class="va">field1</span> <span class="op">&lt;-</span> <span class="fu">matrix_to_raster</span><span class="op">(</span><span class="va">res1</span>, proj.grid.mat <span class="op">=</span> <span class="va">proj</span><span class="op">)</span></span>
<span>                     <span class="co">#field1 &lt;- crop(field1, boundary1)</span></span>
<span>                     <span class="co">#field1 &lt;- mask(field1, boundary1)</span></span>
<span>                     <span class="co">#plot(field1)</span></span>
<span>                     <span class="co">#field1</span></span>
<span>                   <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">field1</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">field1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#Plotting rasters</span></span>
<span><span class="va">plot_raster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rast</span>, <span class="va">cat</span>, <span class="va">names</span>,</span>
<span>                        <span class="va">sc</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        <span class="va">col1</span> <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>                        <span class="va">ymin</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">ymax</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        <span class="va">legkeywidth</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        <span class="va">poly</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">sp_eus2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html" class="external-link">fortify</a></span><span class="op">(</span><span class="va">poly</span><span class="op">)</span></span>
<span>  <span class="va">rast_gc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">rast</span><span class="op">[[</span><span class="va">cat</span><span class="op">]</span><span class="op">]</span>, <span class="st">"SpatialPixelsDataFrame"</span><span class="op">)</span></span>
<span>  <span class="va">rast_gc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">rast_gc1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rast_gc1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">gc1_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rast_gc1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># geom_polygon(data = poly, aes(x = long, y = lat, group = group),</span></span>
<span>    <span class="co">#              fill = NA, color = "gray20", size = 0.25) +</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># remove axis lines ..</span></span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                       <span class="co"># .. tickmarks..</span></span>
<span>          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>          legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>          legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="va">legkeywidth</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#scale_fill_viridis(option = col1, direction = -1, limits = c(ymin, ymax)) +</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdYlBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">sc</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span></span>
<span>    <span class="va">gc1_pred</span> <span class="op">&lt;-</span> <span class="va">gc1_pred</span> <span class="op">+</span></span>
<span>      <span class="fu">ggsn</span><span class="fu">::</span><span class="fu">scalebar</span><span class="op">(</span><span class="va">sp_eus2</span>, location <span class="op">=</span> <span class="st">"bottomright"</span>,</span>
<span>                     dist <span class="op">=</span> <span class="fl">200</span>, transform <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     st.size <span class="op">=</span> <span class="fl">3</span>, st.dist <span class="op">=</span> <span class="fl">0.05</span>, height<span class="op">=</span><span class="fl">0.03</span>,</span>
<span>                     dist_unit <span class="op">=</span> <span class="st">"km"</span><span class="op">)</span></span>
<span>    <span class="co">#ggsn::north(sp_eus2, location = "topright", scale = 0.2,</span></span>
<span>    <span class="co">#            symbol = 4)</span></span>
<span>    <span class="co">#ggsn::north2(sp_eus2, x = 0.65, y = 0.9, scale = 0.1, symbol = 1)</span></span>
<span>    <span class="co">#</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">gc1_pred</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">colsc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdYlBu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">...</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-a-dataset-with-replicate-random-effects">Simulating a dataset with replicate random effects<a class="anchor" aria-label="anchor" href="#simulating-a-dataset-with-replicate-random-effects"></a>
</h2>
<p>Defining some parameters and seeds for replicating.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_range</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">true_sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">314</span><span class="op">)</span></span>
<span><span class="va">inla.seed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1E6</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="constructing-a-2d-model-in-a-grid">Constructing a 2D model in a grid<a class="anchor" aria-label="anchor" href="#constructing-a-2d-model-in-a-grid"></a>
</h3>
<p>We will now construct a 2D model, generate a sample of a random
field, and attempt to recover the field from observations at a few
locations. First, we build a high resolution mesh for the true field,
using low level INLA functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bnd</span> <span class="op">&lt;-</span> <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/spoly.html" class="external-link">spoly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mesh_fine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">inla.mesh.2d</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">bnd</span>, max.edge <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh_fine</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: the priors here will not be used in estimation</span></span>
<span><span class="va">matern_fine</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span><span class="va">mesh_fine</span>,</span>
<span>                      prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                      prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">true_Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.precision.html" class="external-link">inla.spde.precision</a></span><span class="op">(</span><span class="va">matern_fine</span>, theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">true_range</span>, <span class="va">true_sigma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="samples-from-the-fields">Samples from the fields<a class="anchor" aria-label="anchor" href="#samples-from-the-fields"></a>
</h3>
<p>Generating a couple of samples from the model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_field</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/qsample.html" class="external-link">inla.qsample</a></span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">true_Q</span>, seed <span class="op">=</span> <span class="va">inla.seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in inla.qsample(D - 1, true_Q, seed = inla.seed): Since 'seed!=0',</span></span>
<span><span class="co">#&gt; parallel model is disabled and serial model is selected</span></span>
<span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">raster_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span></span>
<span><span class="va">raster_predict</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">raster_predict</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span></span>
<span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span></span>
<span>  <span class="va">mesh_fine</span>,</span>
<span>  loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span>,</span>
<span>  field <span class="op">=</span> <span class="va">true_field</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">truth</span>, <span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"field"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span></span>
<span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">truth</span>, <span class="st">"SpatialPixelsDataFrame"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dd</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">csc1</span> <span class="op">&lt;-</span> <span class="fu">colsc</span><span class="op">(</span><span class="va">truth</span><span class="op">[[</span><span class="va">dd</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">truth</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"field"</span>, <span class="va">dd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"True field "</span>, <span class="va">dd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">csc1</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `aes_string()` was deprecated in ggplot2 3.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use tidy evaluation idioms with `aes()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See also `vignette("ggplot2-in-packages")` for more information.</span></span>
<span><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span>
<span></span>
<span><span class="va">truth_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/multiplot.html" class="external-link">multiplot</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plot_truth</span>,  cols <span class="op">=</span> <span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="observations-from-points--adding-covariates">Observations from points. Adding covariates<a class="anchor" aria-label="anchor" href="#observations-from-points--adding-covariates"></a>
</h3>
<p>Extract observations from some random locations:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">51</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">D</span></span>
<span><span class="co">#betas &lt;- matrix(c(2.2, -2.4), nrow = D-1, byrow = FALSE)</span></span>
<span><span class="op">(</span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                    <span class="op">-</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,]  2.275975</span></span>
<span><span class="co">#&gt; [2,] -2.299530</span></span>
<span></span>
<span></span>
<span><span class="co">#Covariance matrix of the response</span></span>
<span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cov_param</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                   lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sigma2</span> <span class="op">+</span> <span class="va">cov_param</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hypers_lik</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>hypers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma2</span>, <span class="va">cov_param</span><span class="op">)</span>,</span>
<span>                         name1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma2.1"</span>, <span class="st">"sigma2.2"</span>,</span>
<span>                                   <span class="st">"gamma"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># We create the correlation parameters based on the previous idea</span></span>
<span><span class="co"># We are going to have ((D-1)^2 - (D-1))/2 rhos</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">sigma_diag</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">cov_param</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">sigma_diag</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rho</span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.1857594</span></span>
<span><span class="co">#&gt; [2,] 0.1857594 1.0000000</span></span>
<span></span>
<span></span>
<span><span class="co">#We define the covariate $\boldsymbol{x}$ and also, the corresponding betas, constructing the corresponding linear predictor.</span></span>
<span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="va">xx</span></span>
<span></span>
<span></span>
<span><span class="co"># - mean 0 to not affect intercept</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Spatial effects. Two different random fields</span></span>
<span><span class="va">spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span></span>
<span>  <span class="va">mesh_fine</span>,</span>
<span>  loc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  field <span class="op">=</span> <span class="va">true_field</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Linear predictors</span></span>
<span><span class="va">lin.pred</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">+</span> <span class="va">spatial</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="alr-coordinates">alr-coordinates<a class="anchor" aria-label="anchor" href="#alr-coordinates"></a>
</h3>
<p>We construct the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-coordinates</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">sigma_diag</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">sigma_diag</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="va">Sigma</span><span class="op">*</span><span class="va">rho</span></span>
<span></span>
<span><span class="va">lin.pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span> n  <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   mu <span class="op">=</span> <span class="va">z</span>,</span>
<span>                   Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">alry</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">alry</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr.y"</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-in-the-simplex">Data in the simplex<a class="anchor" aria-label="anchor" href="#data-in-the-simplex"></a>
</h3>
<p>We move back to the Simplex using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">alr</annotation></semantics></math>-inverse,
in particular, we use the function <code>alrInv</code> form the
R-package <code>compositions</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y.simplex</span> <span class="op">&lt;-</span> <span class="fu">compositions</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alrInv</a></span><span class="op">(</span><span class="va">alry</span><span class="op">)</span></span>
<span><span class="va">y.simplex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y.simplex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="va">D</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y.simplex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">alry</span>, <span class="va">y.simplex</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#&gt;        lon       lat          xx       alr.y1     alr.y2        y1         y2</span></span>
<span><span class="co">#&gt; 1 2.164178 7.5629924 -0.33326109 -0.846303168  2.4042713 0.0343216 0.88567429</span></span>
<span><span class="co">#&gt; 2 8.344236 7.7793818 -0.04749689  0.399583098 -0.5431795 0.4854016 0.18908828</span></span>
<span><span class="co">#&gt; 3 7.513832 8.1528313 -0.49554979 -0.752270018  0.1622192 0.1780211 0.44425174</span></span>
<span><span class="co">#&gt; 4 4.060105 0.2253018  0.45511586  0.052528066 -3.3525703 0.5045329 0.01675229</span></span>
<span><span class="co">#&gt; 5 9.710200 2.8148251  0.49812543  2.512558663 -1.8879415 0.9146355 0.01122368</span></span>
<span><span class="co">#&gt; 6 1.123315 1.1945009  0.16154746 -0.001549842 -2.6863049 0.4831410 0.03296853</span></span>
<span><span class="co">#&gt;           y3</span></span>
<span><span class="co">#&gt; 1 0.08000411</span></span>
<span><span class="co">#&gt; 2 0.32551011</span></span>
<span><span class="co">#&gt; 3 0.37772716</span></span>
<span><span class="co">#&gt; 4 0.47871480</span></span>
<span><span class="co">#&gt; 5 0.07414087</span></span>
<span><span class="co">#&gt; 6 0.48389042</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-response">Plotting the response<a class="anchor" aria-label="anchor" href="#plotting-the-response"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html" class="external-link">fortify</a></span><span class="op">(</span><span class="va">bnd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `fortify(&lt;SpatialPolygonsDataFrame&gt;)` was deprecated in ggplot2 3.4.4.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please migrate to sf.</span></span>
<span><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span><span class="va">data_plot</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">D</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">D</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bound</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,</span>
<span>                                 y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">'gray70'</span>, fill <span class="op">=</span> <span class="st">'gray90'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_plot</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">lat</span>,</span>
<span>                 <span class="co">#size = value,</span></span>
<span>                 color <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                          <span class="co"># remove axis lines ..</span></span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                       <span class="co"># .. tickmarks..</span></span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#guides(fill = guide_legend(title.position="top", title.hjust = 0.5)) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"magma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/INLAcomp/INLAcomp/vignettes"</span></span>
<span></span>
<span><span class="co">#pdf("simulation_data.pdf", width = 10, height = 5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-alr-coordiantes">Plotting the alr-coordiantes<a class="anchor" aria-label="anchor" href="#plotting-the-alr-coordiantes"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">data_plot_alr</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr.y"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr.y"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co">#Plotting the map</span></span>
<span>  <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bound</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>,</span>
<span>                                   y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>,</span>
<span>                 colour <span class="op">=</span> <span class="st">'gray70'</span>, fill <span class="op">=</span> <span class="st">'gray90'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_plot_alr</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">lat</span>,</span>
<span>                   <span class="co">#size = value,</span></span>
<span>                   color <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.8</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">name</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                          <span class="co"># remove axis lines ..</span></span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                       <span class="co"># .. tickmarks..</span></span>
<span>          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>          legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>          legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>          legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>          strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#guides(fill = guide_legend(title.position="top", title.hjust = 0.5)) +</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"magma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                        name <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#pdf("simulation_data_alr.pdf", width = 9, height = 5)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="preparing-the-data-for-fitting">Preparing the data for fitting<a class="anchor" aria-label="anchor" href="#preparing-the-data-for-fitting"></a>
</h2>
<div class="section level3">
<h3 id="defining-a-new-column-with-the-values-of-all-alr-coordinates">Defining a new column with the values of all <code>alr</code>
coordinates<a class="anchor" aria-label="anchor" href="#defining-a-new-column-with-the-values-of-all-alr-coordinates"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">names_gc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_ext</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">.</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr."</span>, <span class="va">names_gc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      names_to  <span class="op">=</span> <span class="st">"alr_gc"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"val_alr_gc"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">alr_gc</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"alr_gc"</span>, <span class="st">"val_alr_gc"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;     lon   lat alr_gc val_alr_gc</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  2.16 7.56  alr.y1   -<span style="color: #BB0000;">0.846</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  8.34 7.78  alr.y1    0.400  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  7.51 8.15  alr.y1   -<span style="color: #BB0000;">0.752</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  4.06 0.225 alr.y1    0.052<span style="text-decoration: underline;">5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  9.71 2.81  alr.y1    2.51   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  1.12 1.19  alr.y1   -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">55</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-index-for-indiciating-which-alr-coordinate-are-we-dealing-with">Defining index for indiciating which alr-coordinate are we dealing
with<a class="anchor" aria-label="anchor" href="#defining-index-for-indiciating-which-alr-coordinate-are-we-dealing-with"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ext</span><span class="op">$</span><span class="va">alr_gc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">$</span><span class="va">alr_gc</span><span class="op">)</span></span>
<span><span class="va">k.group</span> <span class="op">&lt;-</span> <span class="va">data_ext</span><span class="op">$</span><span class="va">alr_gc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#For group</span></span>
<span><span class="va">k.repl</span>  <span class="op">&lt;-</span> <span class="va">data_ext</span><span class="op">$</span><span class="va">alr_gc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#For replication</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">k.group</span>, <span class="va">k.repl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   k.group k.repl</span></span>
<span><span class="co">#&gt; 1       1      1</span></span>
<span><span class="co">#&gt; 2       1      1</span></span>
<span><span class="co">#&gt; 3       1      1</span></span>
<span><span class="co">#&gt; 4       1      1</span></span>
<span><span class="co">#&gt; 5       1      1</span></span>
<span><span class="co">#&gt; 6       1      1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-mesh">The mesh<a class="anchor" aria-label="anchor" href="#the-mesh"></a>
</h3>
<p>We create the mesh as we usually do in <strong>R-INLA</strong> for
spatial effects.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.2d.html" class="external-link">inla.mesh.2d</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                     max.edge <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                     cutoff   <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                     min.angle<span class="op">=</span> <span class="fl">30</span>,</span>
<span>                     offset   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 class="tabset" id="defining-the-spde">Defining the spde<a class="anchor" aria-label="anchor" href="#defining-the-spde"></a>
</h3>
<div class="section level4">
<h4 id="defining-spde-with-priors">Defining spde with priors<a class="anchor" aria-label="anchor" href="#defining-spde-with-priors"></a>
</h4>
<p>We use PC-priors for defining the spde object.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">range0</span> <span class="op">&lt;-</span> <span class="va">size</span> <span class="op">/</span> <span class="fl">4</span>  <span class="co"># ~ default</span></span>
<span><span class="va">spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html" class="external-link">inla.spde2.pcmatern</a></span><span class="op">(</span>mesh        <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>                            prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">range0</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="co"># P(range &lt; range0) = 0.25</span></span>
<span>                            prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="co"># P(sigma &gt; 1) = 0.01</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 class="tabset" id="index-for-the-spatial-effects">Index for the spatial effects<a class="anchor" aria-label="anchor" href="#index-for-the-spatial-effects"></a>
</h4>
<p>We distinguish if we copy the spatial effect or we replicate it.</p>
<div class="section level5">
<h5 id="spatial-index-to-be-used-in-the-model--we-define-it-by-alr-coordinate">Spatial index to be used in the model. We define it by
alr-coordinate<a class="anchor" aria-label="anchor" href="#spatial-index-to-be-used-in-the-model--we-define-it-by-alr-coordinate"></a>
</h5>
<p>This spatial index is useful when we replicate spatial effects, in
other words, when we have one spatial effect per linear predictor whose
realizations are different and hyperparameters are equal.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.index.html" class="external-link">inla.spde.make.index</a></span><span class="op">(</span><span class="st">'i'</span>, n.spde <span class="op">=</span> <span class="va">spde</span><span class="op">$</span><span class="va">n.spde</span>,</span>
<span>                             n.repl  <span class="op">=</span> <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="co">#Replicating spatial effect</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="this-iset-is-for-copy">This iset is for copy<a class="anchor" aria-label="anchor" href="#this-iset-is-for-copy"></a>
</h5>
<p>This spatial index is useful when we copy spatial effects, in other
words, when we have one spatial effect per linear predictor whose
realizations are equal or proportionally equivalente, and
hyperparameters are equal.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iset2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.index.html" class="external-link">inla.spde.make.index</a></span><span class="op">(</span><span class="st">'i'</span>, n.spde <span class="op">=</span> <span class="va">spde</span><span class="op">$</span><span class="va">n.spde</span><span class="op">)</span></span>
<span><span class="va">iset_aux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">-</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">iset_aux</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">iset2</span> <span class="op">&lt;-</span> <span class="fu">kronecker</span><span class="op">(</span><span class="va">iset_aux</span>, <span class="va">iset2</span><span class="op">$</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">iset2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"iset.alr"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="defining-the-projection-matrix">Defining the projection matrix<a class="anchor" aria-label="anchor" href="#defining-the-projection-matrix"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde.make.A.html" class="external-link">inla.spde.make.A</a></span><span class="op">(</span>mesh  <span class="op">=</span> <span class="va">mesh</span>,</span>
<span>                          loc   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">$</span><span class="va">lon</span>, <span class="va">data_ext</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span>,</span>
<span>                          repl  <span class="op">=</span> <span class="va">k.repl</span><span class="op">)</span></span>
<span><span class="va">A.est2</span> <span class="op">&lt;-</span> <span class="va">A.est</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 class="tabset" id="defining-the-corresponding-part-to-the-shared-random-effect">Defining the corresponding part to the shared random
effect<a class="anchor" aria-label="anchor" href="#defining-the-corresponding-part-to-the-shared-random-effect"></a>
</h3>
<div class="section level4">
<h4 id="index-for-the-random-effect-that-is-going-to-give-the-correlation">Index for the random effect that is going to give the
correlation<a class="anchor" aria-label="anchor" href="#index-for-the-random-effect-that-is-going-to-give-the-correlation"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id.z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_ext</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="index-for-indicating-the-alr-coordinate">Index for indicating the alr coordinate<a class="anchor" aria-label="anchor" href="#index-for-indicating-the-alr-coordinate"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id.cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="defining-the-inla-stack">Defining the <code class="tabset">inla.stack</code><a class="anchor" aria-label="anchor" href="#defining-the-inla-stack"></a>
</h3>
<div class="section level4">
<h4 id="response">Response<a class="anchor" aria-label="anchor" href="#response"></a>
</h4>
<p>We define a list with three elements (three alr-coordinates) in the
format that <strong>R-INLA</strong> uses when deal with several
likelihoods.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Response</span></span>
<span><span class="va">names_alr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr."</span>, <span class="va">names_gc</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names_alr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">alr_gc</span> <span class="op">==</span> <span class="va">names_alr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_comp_i</span></span>
<span>    <span class="co">#Response</span></span>
<span>    <span class="va">y_alr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="va">names_alr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_comp_i</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_alr</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data_comp_i</span><span class="op">$</span><span class="va">val_alr_gc</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y_alr</span></span>
<span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">names_alr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y_aux</span> <span class="op">&lt;-</span> <span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">val_alr_gc</span>, <span class="va">alr_gc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">alr_gc</span> <span class="op">==</span> <span class="va">names_alr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">val_alr_gc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>    <span class="va">aux_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">aux_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="fu">kronecker</span><span class="op">(</span><span class="va">aux_vec</span>, <span class="va">y_aux</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">y_alr_list</span></span>
<span></span>
<span><span class="va">y_alr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">y_alr_list</span><span class="op">)</span></span>
<span><span class="va">y_alr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;               [,1] [,2]</span></span>
<span><span class="co">#&gt;  [1,] -0.846303168   NA</span></span>
<span><span class="co">#&gt;  [2,]  0.399583098   NA</span></span>
<span><span class="co">#&gt;  [3,] -0.752270018   NA</span></span>
<span><span class="co">#&gt;  [4,]  0.052528066   NA</span></span>
<span><span class="co">#&gt;  [5,]  2.512558663   NA</span></span>
<span><span class="co">#&gt;  [6,] -0.001549842   NA</span></span>
<span><span class="co">#&gt;  [7,]  1.164093794   NA</span></span>
<span><span class="co">#&gt;  [8,]  2.047636770   NA</span></span>
<span><span class="co">#&gt;  [9,]  0.564710978   NA</span></span>
<span><span class="co">#&gt; [10,]  1.064159558   NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h4>
<p>Covariates are going to be included in the model as random effects
with big variance. So, we need the values of the covariates (the scaled
one), and also, an index indicating to which alr-coordinate it
belongs.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intercept"</span>, <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"id."</span>, <span class="va">variables</span><span class="op">)</span></span>
<span><span class="va">id.variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">id.cat</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">variables</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">id.variables</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id.names</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="inla-stack-for-estimation">Inla stack for estimation<a class="anchor" aria-label="anchor" href="#inla-stack-for-estimation"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stk.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack</a></span><span class="op">(</span>data    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">y_alr</span><span class="op">)</span>,</span>
<span>                      A       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">A.est</span>, <span class="fl">1</span>, <span class="va">A.est2</span><span class="op">)</span>,</span>
<span>                      effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iset</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data_ext</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                             <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"xx"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                           <span class="va">id.z</span>,</span>
<span>                                           <span class="va">id.variables</span>,</span>
<span>                                           intercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">iset2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      tag     <span class="op">=</span> <span class="st">'est'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="fitting-the-different-models">Fitting the different models<a class="anchor" aria-label="anchor" href="#fitting-the-different-models"></a>
</h2>
<div class="section level3">
<h3 id="type-i">Type I<a class="anchor" aria-label="anchor" href="#type-i"></a>
</h3>
<p>Share the same parameters for fixed effects, and do not include
spatial random e↵ects.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula.typeI</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="va">xx</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeI</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-ii">Type II<a class="anchor" aria-label="anchor" href="#type-ii"></a>
</h3>
<p>Have different parameters for fixed effects, and do not include
spatial random e↵ects.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula.typeII</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.xx</span>, <span class="va">xx</span>, <span class="co">#BIO1</span></span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeII</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeII</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-iii">Type III<a class="anchor" aria-label="anchor" href="#type-iii"></a>
</h3>
<p>Share the same parameters for fixed effects, and share the same
spatial effect.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula.typeIII</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="va">xx</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr1</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr2</span>, copy <span class="op">=</span> <span class="st">"iset.alr1"</span>, </span>
<span>    fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeIII</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeIII</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-iv">Type IV<a class="anchor" aria-label="anchor" href="#type-iv"></a>
</h3>
<p>Have different parameters for fixed effects, and share the same
spatial effect.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula.typeIV</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.xx</span>, <span class="va">xx</span>, </span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr1</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr2</span>, copy <span class="op">=</span> <span class="st">"iset.alr1"</span>, </span>
<span>    fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeIV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeIV</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-v">Type V<a class="anchor" aria-label="anchor" href="#type-v"></a>
</h3>
<p>Share the same parameters for fixed effects, and the spatial effects
between linear predictors are proportional.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula.typeV</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="va">xx</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr1</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr2</span>, copy <span class="op">=</span> <span class="st">"iset.alr1"</span>, </span>
<span>    fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeV</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-vi">Type VI<a class="anchor" aria-label="anchor" href="#type-vi"></a>
</h3>
<p>Have different parameters for fixed effects, and the spatial effects
between linear predictors are proportional</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula.typeVI</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.xx</span>, <span class="va">xx</span>, <span class="co">#xx</span></span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr1</span>, model <span class="op">=</span> <span class="va">spde</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">iset.alr2</span>, copy <span class="op">=</span> <span class="st">"iset.alr1"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="cn">FALSE</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">model.typeVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeVI</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,  </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#model.typeVI &lt;- inla.rerun(model.typeVI)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-vii">Type VII<a class="anchor" aria-label="anchor" href="#type-vii"></a>
</h3>
<p>Share the same parameters for fixed effects, and different
realisations of the spatial effect for each linear predictor</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula.typeVII</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="va">xx</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>,</span>
<span>    model <span class="op">=</span> <span class="va">spde</span>,</span>
<span>    replicate <span class="op">=</span> <span class="va">i.repl</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeVII</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeVII</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   inla.mode <span class="op">=</span> <span class="st">"experimental"</span> , </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type-viii">Type VIII<a class="anchor" aria-label="anchor" href="#type-viii"></a>
</h3>
<p>Have different parameters for fixed effects, and different
realisations of the spatial effect for each linear predictor</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula.typeVIII</span> <span class="op">&lt;-</span> <span class="va">resp</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.xx</span>, <span class="va">xx</span>, <span class="co">#xx</span></span>
<span>    model   <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>,</span>
<span>    fixed   <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">i</span>,</span>
<span>    model <span class="op">=</span> <span class="va">spde</span>,</span>
<span>    replicate <span class="op">=</span> <span class="va">i.repl</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id.z</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"iid"</span>,</span>
<span>    hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                             param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, constr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.typeVIII</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">formula.typeVIII</span>,</span>
<span>                   family         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                   data           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.data</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>,</span>
<span>                   control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>config <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                          dic  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          waic <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                          cpo  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.stack.html" class="external-link">inla.stack.A</a></span><span class="op">(</span><span class="va">stk.est</span><span class="op">)</span>, </span>
<span>                                            compute <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                   control.family <span class="op">=</span> <span class="va">list_prior</span>,   </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparing-using-dic-waic-and-lcpo">Comparing using DIC, WAIC and LCPO<a class="anchor" aria-label="anchor" href="#comparing-using-dic-waic-and-lcpo"></a>
</h2>
<p>In this tutorial, for the moment, we compute the DIC, WAIC and LCPO
for all the models.</p>
<p>DIC and WAIC: We obtain the joint posterior distribution of the model
using the <code>inla.posterior.sample</code> function. We use the
functions <code>dic.mult</code> and <code>waic.mult</code> for computing
the new DIC and WAIC.</p>
<p>CPO: We define friends in our dataset. We use the function
<code>inla.group.cv</code> with the argument
<code>num.level.sets = -1</code> for computing the CPO.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model.typeI</span>,</span>
<span>               <span class="va">model.typeII</span>,</span>
<span>               <span class="va">model.typeIII</span>,</span>
<span>               <span class="va">model.typeIV</span>,</span>
<span>               <span class="va">model.typeV</span>,</span>
<span>               <span class="va">model.typeVI</span>,</span>
<span>               <span class="va">model.typeVII</span>,</span>
<span>               <span class="va">model.typeVIII</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span>, <span class="st">"V"</span>, <span class="st">"VI"</span>, <span class="st">"VII"</span>, <span class="st">"VIII"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Computing measures of this model</span></span>
<span><span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">model_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/posterior.sample.html" class="external-link">inla.posterior.sample</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">mod1</span>, seed <span class="op">=</span> <span class="va">inla.seed</span><span class="op">)</span></span>
<span>  <span class="va">inf</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fu">INLAcomp</span><span class="fu">::</span><span class="va"><a href="../reference/extract_lp_sigma.html">extract_lp_sigma</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#DIC</span></span>
<span>  <span class="va">dic.mod1</span> <span class="op">&lt;-</span> <span class="fu">INLAcomp</span><span class="fu">::</span><span class="fu"><a href="../reference/dic.mult.html">dic.mult</a></span><span class="op">(</span><span class="va">inf</span>, y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr.y"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#WAIc</span></span>
<span>  <span class="va">waic.mod1</span> <span class="op">&lt;-</span> <span class="fu">INLAcomp</span><span class="fu">::</span><span class="fu"><a href="../reference/waic.mult.html">waic.mult</a></span><span class="op">(</span><span class="va">inf</span>, y <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"alr.y"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#lIST FOR cpo</span></span>
<span>  <span class="va">friends_list</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="op">-</span><span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">res</span></span>
<span>    <span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    </span>
<span>  <span class="va">a4</span> <span class="op">&lt;-</span> <span class="fu">INLA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/group.cv.html" class="external-link">inla.group.cv</a></span><span class="op">(</span>result <span class="op">=</span> <span class="va">mod1</span>,</span>
<span>                          num.level.sets <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                          strategy <span class="op">=</span> <span class="st">"posterior"</span>,</span>
<span>                          friends <span class="op">=</span> <span class="va">friends_list</span>,</span>
<span>                          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">LCPO</span> <span class="op">&lt;-</span> <span class="va">a4</span><span class="op">$</span><span class="va">cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">-</span><span class="va">.</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>DIC <span class="op">=</span> <span class="va">dic.mod1</span>, WAIC <span class="op">=</span> <span class="va">waic.mod1</span>, LCPO <span class="op">=</span> <span class="va">LCPO</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span><span class="co">#&gt; Warning in inla.posterior.sample(n, rfake, intern = intern, use.improved.mean =</span></span>
<span><span class="co">#&gt; use.improved.mean, : Since 'seed!=0', parallel model is disabled and serial</span></span>
<span><span class="co">#&gt; model is selected, num.threads='1:1'</span></span>
<span></span>
<span><span class="va">measures</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">measures</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">xtable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xtable/man/xtable.html" class="external-link">xtable</a></span><span class="op">(</span><span class="va">measures</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DIC.dic"</span>, <span class="st">"WAIC.waic"</span>, <span class="st">"LCPO"</span><span class="op">)</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; % latex table generated in R 4.4.1 by xtable 1.8-4 package</span></span>
<span><span class="co">#&gt; % Fri Sep 20 15:20:26 2024</span></span>
<span><span class="co">#&gt; \begin{table}[ht]</span></span>
<span><span class="co">#&gt; \centering</span></span>
<span><span class="co">#&gt; \begin{tabular}{rrrr}</span></span>
<span><span class="co">#&gt;   \hline</span></span>
<span><span class="co">#&gt;  &amp; DIC.dic &amp; WAIC.waic &amp; LCPO \\ </span></span>
<span><span class="co">#&gt;   \hline</span></span>
<span><span class="co">#&gt; typeI &amp; 7326.280 &amp; 7326.363 &amp; 1.830 \\ </span></span>
<span><span class="co">#&gt;   typeII &amp; 6920.997 &amp; 6921.282 &amp; 1.729 \\ </span></span>
<span><span class="co">#&gt;   typeIII &amp; 6599.444 &amp; 6585.952 &amp; 1.642 \\ </span></span>
<span><span class="co">#&gt;   typeIV &amp; 6194.114 &amp; 6174.317 &amp; 1.536 \\ </span></span>
<span><span class="co">#&gt;   typeV &amp; 6567.011 &amp; 6577.076 &amp; 1.643 \\ </span></span>
<span><span class="co">#&gt;   typeVI &amp; 5698.696 &amp; 5695.981 &amp; 1.596 \\ </span></span>
<span><span class="co">#&gt;   typeVII &amp; 5792.595 &amp; 5804.340 &amp; 1.452 \\ </span></span>
<span><span class="co">#&gt;   typeVIII &amp; 4719.775 &amp; 4738.928 &amp; 1.183 \\ </span></span>
<span><span class="co">#&gt;    \hline</span></span>
<span><span class="co">#&gt; \end{tabular}</span></span>
<span><span class="co">#&gt; \end{table}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="tabset" id="checking-posterior-distributions-of-the-best-model">Checking posterior distributions of the best
model<a class="anchor" aria-label="anchor" href="#checking-posterior-distributions-of-the-best-model"></a>
</h2>
<div class="section level3">
<h3 id="recovering-spatial-random-fields">Recovering spatial random fields<a class="anchor" aria-label="anchor" href="#recovering-spatial-random-fields"></a>
</h3>
<p>We represent the median and credible intervals 95% for the spatial
random fields.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model.typeVIII</span></span>
<span><span class="va">spatial_median</span> <span class="op">&lt;-</span> <span class="fu">raster_spatial_effect</span><span class="op">(</span>spatial <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">summary.random</span><span class="op">[[</span><span class="st">'i'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'0.5quant'</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                      boundary <span class="op">=</span> <span class="va">raster_predict</span>,</span>
<span>                                      boundary1 <span class="op">=</span> <span class="va">bnd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial_q.025</span> <span class="op">&lt;-</span> <span class="fu">raster_spatial_effect</span><span class="op">(</span>spatial <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">summary.random</span><span class="op">[[</span><span class="st">'i'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"0.025quant"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                         boundary <span class="op">=</span> <span class="va">raster_predict</span>,</span>
<span>                                         boundary1 <span class="op">=</span> <span class="va">bnd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial_q.975</span> <span class="op">&lt;-</span> <span class="fu">raster_spatial_effect</span><span class="op">(</span>spatial <span class="op">=</span> <span class="va">model</span><span class="op">$</span><span class="va">summary.random</span><span class="op">[[</span><span class="st">'i'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"0.975quant"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                         boundary <span class="op">=</span> <span class="va">raster_predict</span>,</span>
<span>                                         boundary1 <span class="op">=</span> <span class="va">bnd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">range.sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_median</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">truth_r</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_q.975</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_q.025</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">range.sp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_median</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">truth_r</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_q.975</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">spatial_q.025</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Plotting</span></span>
<span><span class="va">p1.alr1.Real</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">truth_r</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y1-Real"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">p1.alr1.median</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_median</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y1-Median"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="va">p1.alr1.025</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_q.025</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y1-Q0.025"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="va">p1.alr1.975</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_q.975</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y1-Q0.975"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="co">## alr2</span></span>
<span><span class="va">p1.alr2.Real</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">truth_r</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y2-Real"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="va">p1.alr2.median</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_median</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y2-Median"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span></span>
<span><span class="va">p1.alr2.025</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_q.025</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           ymin <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                           poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                           cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           names <span class="op">=</span> <span class="st">"alr.y2-Q0.025"</span>,</span>
<span>                           legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="va">p1.alr2.975</span> <span class="op">&lt;-</span> <span class="fu">plot_raster</span><span class="op">(</span>rast <span class="op">=</span> <span class="va">spatial_q.975</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                            ymin <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">range.sp2</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            poly <span class="op">=</span> <span class="va">bnd</span>,</span>
<span>                            cat <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            names <span class="op">=</span> <span class="st">"alr.y2-Q0.975"</span>,</span>
<span>                            legkeywidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Regions defined for each Polygons</span></span>
<span></span>
<span><span class="va">mylegend_alr1</span> <span class="op">&lt;-</span> <span class="fu">g_legend</span><span class="op">(</span><span class="va">p1.alr1.Real</span><span class="op">)</span></span>
<span><span class="va">mylegend_alr2</span> <span class="op">&lt;-</span> <span class="fu">g_legend</span><span class="op">(</span><span class="va">p1.alr2.Real</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">p1.alr1.Real</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr1.median</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr1.025</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr1.975</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                        <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">mylegend_alr1</span>,</span>
<span>                                    nrow <span class="op">=</span> <span class="fl">1</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">p1.alr2.Real</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr2.median</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr2.025</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    <span class="va">p1.alr2.975</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                    nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                        <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">mylegend_alr2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">1</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#png(paste0("spatial","_", N, ".png"), width = 1400, height = 1050, res = 150)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recovering-corresponding-to-the-fixed-effects">Recovering corresponding to the fixed effects<a class="anchor" aria-label="anchor" href="#recovering-corresponding-to-the-fixed-effects"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">$</span><span class="va">id.xx</span><span class="op">[[</span><span class="va">xx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>             alr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="va">xx</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>             var <span class="op">=</span> <span class="st">"beta1"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">.</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">data_fixed2</span></span>
<span><span class="co">#data_fixed &lt;- rbind(data_fixed, data_fixed2)</span></span>
<span><span class="va">data_fixed</span> <span class="op">&lt;-</span> <span class="va">data_fixed2</span></span>
<span><span class="va">data_fixed</span><span class="op">$</span><span class="va">alrvar</span> <span class="op">=</span> <span class="va">data_fixed</span><span class="op">$</span><span class="va">alr</span></span>
<span></span>
<span><span class="va">fixed.real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">betas</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         alrvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">p.fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_fixed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed.real</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">real</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">alrvar</span>, nrow <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>               labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/label_bquote.html" class="external-link">label_bquote</a></span><span class="op">(</span><span class="va">beta</span> <span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">^</span> <span class="fu">.</span><span class="op">(</span><span class="va">alrvar</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">^</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">p</span><span class="op">(</span><span class="va">beta</span><span class="op">^</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">*</span><span class="st">'|'</span><span class="op">*</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span>
<span></span>
<span><span class="co">#pdf("posterior_fixed.pdf", width = 6, height = 5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p.fixed</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recovering-hyperparameters">Recovering hyperparameters<a class="anchor" aria-label="anchor" href="#recovering-hyperparameters"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">$</span><span class="va">`Precision for id.z`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span>,</span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.tmarginal</a></span><span class="op">(</span><span class="va">prec</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>                <span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sigma2."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="st">"gamma"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">hyper</span>,</span>
<span>           sigma.sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">[[</span><span class="st">"Stdev for i"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html" class="external-link">inla.smarginal</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">marginals.hyperpar</span><span class="op">[[</span><span class="st">"Range for i"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hyper.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span>,</span>
<span>                   <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, name1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hyper</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span>                   <span class="op">}</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span>,</span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sigma2."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                     <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma.sp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#hyper.df$name1 &lt;- as.character(hyper.df$name1)</span></span>
<span></span>
<span></span>
<span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">hyper.df</span><span class="op">$</span><span class="va">name1</span>,</span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma2.1"</span>, <span class="st">"sigma2.2"</span>,</span>
<span>                                     <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma.sp"</span><span class="op">)</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma[1]^2"</span>, <span class="st">"sigma[2]^2"</span>, <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma[w]"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hyper.real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma2</span>, <span class="va">cov_param</span>, <span class="va">true_range</span>, <span class="va">true_sigma</span><span class="op">)</span>,</span>
<span>                         name1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sigma2."</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma.sp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hyper.real</span><span class="op">$</span><span class="va">name1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">hyper.real</span><span class="op">$</span><span class="va">name1</span><span class="op">)</span></span>
<span><span class="va">hyper.real</span><span class="op">$</span><span class="va">name1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">hyper.real</span><span class="op">$</span><span class="va">name1</span>,</span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma2.1"</span>, <span class="st">"sigma2.2"</span>,</span>
<span>                                     <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma.sp"</span><span class="op">)</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma[1]^2"</span>, <span class="st">"sigma[2]^2"</span>, <span class="st">"gamma"</span>, <span class="st">"phi"</span>, <span class="st">"sigma[w]"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">p.hyper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hyper.df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hyper.real</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">real</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red4"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">name1</span>, scales <span class="op">=</span> <span class="st">"free"</span>, </span>
<span>             labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">p</span><span class="op">(</span><span class="va">theta</span><span class="op">*</span><span class="st">'|'</span><span class="op">*</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#pdf("simulation_data_hyperpar.pdf", width = 9, height = 5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p.hyper</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulations_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dev.off()</span></span>
<span>  </span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-martinezminaya2023" class="csl-entry">
Martı́nez-Minaya, Joaquı́n, and Haavard Rue. 2024. <span>“A Flexible
Bayesian Tool for CoDa Mixed Models: Logistic-Normal Distribution with
Dirichlet Covariance.”</span> <em>Statistics and Computing</em> 34 (3):
116.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joaquín Martínez-Minaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
